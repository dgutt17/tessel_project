var tessel = require('tessel');
var infraredlib = require('ir-attx4');
var infrared = infraredlib.use(tessel.port['B']);
var rfidlib = require('rfid-pn532');
var rfid = rfidlib.use(tessel.port['A']);

const userRFID = []
let currentUser = ''
let currentSong = []
const bufferObject = []

let i = 0
// If we get data, push to database
infrared.on('data', function (data) {
  bufferObject.push({ name: i, bufferObj: JSON.stringify(data) })
  console.log("Received RX Data: ", data);
  i++
});

rfid.on('ready', function (version) {
  console.log('Ready to read RFID card');

  rfid.on('data', function (card) {
    userRFID.push({
      userRfid: card.uid.toString('hex'),
      playlist: {
        [oneBuffer]:
          'https://www.youtube.com/watch?v=FTQbiNvZqaY'
      }
    })
    console.log('UID:', card.uid.toString('hex'));
  });
});

rfid.on('error', function (err) {
  console.error(err);
});

// // When we're connected
// infrared.on('ready', function () {
//   console.log("Connected to IR!");
//   // Start sending a signal every three seconds
//   setInterval(function () {
//     // Make a buffer of on/off durations (each duration is 16 bits)
//     var powerBuffer = new Buffer([0x22, 0xc4, 0xee, 0xd0, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x8a, 0xf9, 0xf2, 0x2, 0x8a, 0xf9, 0xc0, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x8a, 0xfe, 0x3e, 0x2, 0x8a, 0xfe, 0x3e, 0x2, 0x8a, 0xf9, 0xc0, 0x2, 0x58, 0xf9, 0xc0, 0x2, 0x8a, 0xfe, 0x3e, 0x2, 0x8a, 0xf9, 0xc0, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x8a, 0xfe, 0x3e, 0x2, 0x8a, 0xf9, 0xc0, 0x2, 0x58, 0xf9, 0xc0, 0x2, 0x8a, 0xf9, 0xf2, 0x2, 0x8a, 0xf9, 0xc0, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x8a, 0xfe, 0x3e, 0x2, 0x8a, 0xfe, 0x3e, 0x2, 0x8a, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xfe, 0xc, 0x2, 0x58, 0xf9, 0xc0, 0x2, 0x8a, 0xf9, 0xc0, 0x2, 0x58, 0xf9, 0xc0, 0x2, 0x58, 0xf9, 0xc0, 0x2, 0x58]);
//     Send the signal at 38 kHz
//     infrared.sendRawSignal(38, powerBuffer, function (err) {
//       if (err) {
//         console.log("Unable to send signal: ", err);
//       } else {
//         console.log("Signal sent!");
//       }
//     });
//   }, 3000); // Every 3 seconds
// });
